{"title":"HBase Shell操作","slug":"hbase-shell-ops","date":"2018-01-20T07:13:20.000Z","updated":"2018-04-22T07:54:42.117Z","comments":true,"excerpt":"","content":"<p>参考自:<a href=\"https://learnhbase.wordpress.com/2013/03/02/hbase-shell-commands/\" target=\"_blank\" rel=\"external\">这里</a></p>\n<ul>\n<li>Hbase环境下进入: <code>hbase shell</code><br><img src=\"/2018/01/20/hbase-shell-ops/1.png\" alt=\"pic\">  </li>\n<li><p>tips: hbase shell下Backspace(退格键)失效,按住ctrl下再按就可以了切记,还有一种方法如果是XShell中可以在File-&gt;Properties-&gt;Terminal-&gt;Keyboard下，把DELETE/BACKSPACE key sequence选为ASCII 127(Ctrl+?)  </p>\n</li>\n<li><p>$whoami                    我是谁?<br><img src=\"/2018/01/20/hbase-shell-ops/2.png\" alt=\"pic\">  </p>\n</li>\n</ul>\n<h1 id=\"General-通用指令\"><a href=\"#General-通用指令\" class=\"headerlink\" title=\"General 通用指令\"></a>General 通用指令</h1><ul>\n<li>$help                        帮助</li>\n<li>$version                    版本<br><img src=\"/2018/01/20/hbase-shell-ops/3.png\" alt=\"pic\">  </li>\n<li>$status                    服务器状态<br><img src=\"/2018/01/20/hbase-shell-ops/4.png\" alt=\"pic\">  </li>\n</ul>\n<h1 id=\"DDL操作\"><a href=\"#DDL操作\" class=\"headerlink\" title=\"DDL操作\"></a>DDL操作</h1><p>$create ‘user’,’info’,’ext’                     创建一个表第一个为表名后面为字段(我们这是在以关系型数据库的思维来创建表,这是不适合的,我们姑且先这么创建)<br><img src=\"/2018/01/20/hbase-shell-ops/5.png\" alt=\"pic\">  </p>\n<ul>\n<li>$list                                        查看表的列表(类似于MySql的show tables;)<br><img src=\"/2018/01/20/hbase-shell-ops/6.png\" alt=\"pic\">  </li>\n<li>$describe ‘user’                            根据表名获取表的描述<br><img src=\"/2018/01/20/hbase-shell-ops/7.png\" alt=\"pic\">  </li>\n<li>$alter ‘user’,’delete’=&gt;’ext’                    删除名字为ext的列族<br><img src=\"/2018/01/20/hbase-shell-ops/8.png\" alt=\"pic\">  </li>\n<li>$desc ‘user’                                再次查看已经成功删除掉了(desc 等同于 describe)<br><img src=\"/2018/01/20/hbase-shell-ops/9.png\" alt=\"pic\">  </li>\n<li>$is_disabled ‘user’                        表的状态是否为disable</li>\n<li>$is_enabled ‘user’                            表的状态是否为enable<br><img src=\"/2018/01/20/hbase-shell-ops/10.png\" alt=\"pic\">  </li>\n<li>$drop ‘user’                                无法删除状态为enable的表<br><img src=\"/2018/01/20/hbase-shell-ops/11.png\" alt=\"pic\">  </li>\n<li>$disable ‘user’                            把表设置为disable(启用为enable)<br><img src=\"/2018/01/20/hbase-shell-ops/12.png\" alt=\"pic\">  </li>\n<li>$$drop ‘user’                                再次drop<br><img src=\"/2018/01/20/hbase-shell-ops/13.png\" alt=\"pic\"><br>成功删除</li>\n<li>$exists ‘user’                                查看是否存在表<br><img src=\"/2018/01/20/hbase-shell-ops/14.png\" alt=\"pic\"><br>也刚好验证了刚才删除表的操作<br>再次将表建立起来</li>\n<li>$create ‘user’,’info’,’ext’<br><img src=\"/2018/01/20/hbase-shell-ops/15.png\" alt=\"pic\">  </li>\n<li>$添加几条数据 put ‘user’, ‘你要的id名’,’你要输入的cf列族:列名’,’value’<br><img src=\"/2018/01/20/hbase-shell-ops/16.png\" alt=\"pic\"><br><img src=\"/2018/01/20/hbase-shell-ops/17.png\" alt=\"pic\">  </li>\n<li>$获取一个id的所有数据<br><img src=\"/2018/01/20/hbase-shell-ops/18.png\" alt=\"pic\">  </li>\n<li>$获取一个id，一个列族的所有数据<br><img src=\"/2018/01/20/hbase-shell-ops/19.png\" alt=\"pic\">  </li>\n<li>$获取一个id，一个列族中一个列的所有数据<br><img src=\"/2018/01/20/hbase-shell-ops/20.png\" alt=\"pic\">  </li>\n<li>$把id的age修改为22<br><img src=\"/2018/01/20/hbase-shell-ops/21.png\" alt=\"pic\">  </li>\n<li>$通过timestamp来获取两个版本的数据<br><img src=\"/2018/01/20/hbase-shell-ops/22.png\" alt=\"pic\">  </li>\n<li>$全表扫描<br><img src=\"/2018/01/20/hbase-shell-ops/23.png\" alt=\"pic\">  </li>\n<li>$删除键值为id的ROW(行)的’info:age’字段<br><img src=\"/2018/01/20/hbase-shell-ops/24.png\" alt=\"pic\">  </li>\n<li>$删除整行<br><img src=\"/2018/01/20/hbase-shell-ops/25.png\" alt=\"pic\">  </li>\n<li>$查询表中有多少行<br><img src=\"/2018/01/20/hbase-shell-ops/26.png\" alt=\"pic\"><br><img src=\"/2018/01/20/hbase-shell-ops/27.png\" alt=\"pic\"><br><img src=\"/2018/01/20/hbase-shell-ops/28.png\" alt=\"pic\"><br><img src=\"/2018/01/20/hbase-shell-ops/29.png\" alt=\"pic\">  </li>\n<li>看到有了一行数据虽然插入两条但都是对同一个id的插入,数据在一个row上</li>\n<li>$为键值为’id’的row增加’info:addr’字段，并使用counter实现递增<br><img src=\"/2018/01/20/hbase-shell-ops/30.png\" alt=\"pic\">  </li>\n<li>我们看到在第一次初始化默认值为1,再次调用自增</li>\n<li>初次设置可以给初始值,然后再次调用也可以设置增加的值<br><img src=\"/2018/01/20/hbase-shell-ops/31.png\" alt=\"pic\">  </li>\n<li>查看这个值(可以看到是按照16进制存的)<br><img src=\"/2018/01/20/hbase-shell-ops/32.png\" alt=\"pic\">  </li>\n<li>获取当前count的值<br><img src=\"/2018/01/20/hbase-shell-ops/33.png\" alt=\"pic\">  </li>\n<li>将整张表清空<br><img src=\"/2018/01/20/hbase-shell-ops/34.png\" alt=\"pic\">  </li>\n</ul>\n<p>下面内容参考自-&gt;<a href=\"https://www.cnblogs.com/hunttown/p/5799850.html\" target=\"_blank\" rel=\"external\">来自</a></p>\n<h2 id=\"权限管理\"><a href=\"#权限管理\" class=\"headerlink\" title=\"权限管理\"></a>权限管理</h2><p>1）分配权限</p>\n<h3 id=\"语法-grant-参数后面用逗号分隔\"><a href=\"#语法-grant-参数后面用逗号分隔\" class=\"headerlink\" title=\"语法 : grant      参数后面用逗号分隔\"></a>语法 : grant <user> <permissions> <table> <column family=\"\"> <column qualifier=\"\"> 参数后面用逗号分隔</column></column></table></permissions></user></h3><h3 id=\"权限用五个字母表示：-“RWXCA”\"><a href=\"#权限用五个字母表示：-“RWXCA”\" class=\"headerlink\" title=\"权限用五个字母表示： “RWXCA”.\"></a>权限用五个字母表示： “RWXCA”.</h3><h3 id=\"READ-‘R’-WRITE-‘W’-EXEC-‘X’-CREATE-‘C’-ADMIN-‘A’\"><a href=\"#READ-‘R’-WRITE-‘W’-EXEC-‘X’-CREATE-‘C’-ADMIN-‘A’\" class=\"headerlink\" title=\"READ(‘R’), WRITE(‘W’), EXEC(‘X’), CREATE(‘C’), ADMIN(‘A’)\"></a>READ(‘R’), WRITE(‘W’), EXEC(‘X’), CREATE(‘C’), ADMIN(‘A’)</h3><h3 id=\"例如，给用户‘test’分配对表t1有读写的权限，\"><a href=\"#例如，给用户‘test’分配对表t1有读写的权限，\" class=\"headerlink\" title=\"例如，给用户‘test’分配对表t1有读写的权限，\"></a>例如，给用户‘test’分配对表t1有读写的权限，</h3><p>hbase(main)&gt; grant ‘test’,’RW’,’t1’</p>\n<p>2）查看权限</p>\n<h3 id=\"语法：user-permission\"><a href=\"#语法：user-permission\" class=\"headerlink\" title=\"语法：user_permission \"></a>语法：user_permission <table></table></h3><h3 id=\"例如，查看表t1的权限列表\"><a href=\"#例如，查看表t1的权限列表\" class=\"headerlink\" title=\"例如，查看表t1的权限列表\"></a>例如，查看表t1的权限列表</h3><p>hbase(main)&gt; user_permission ‘t1’</p>\n<p>3）收回权限</p>\n<h3 id=\"与分配权限类似，语法：revoke\"><a href=\"#与分配权限类似，语法：revoke\" class=\"headerlink\" title=\"与分配权限类似，语法：revoke    \"></a>与分配权限类似，语法：revoke <user> <table> <column family=\"\"> <column qualifier=\"\"></column></column></table></user></h3><h3 id=\"例如，收回test用户在表t1上的权限\"><a href=\"#例如，收回test用户在表t1上的权限\" class=\"headerlink\" title=\"例如，收回test用户在表t1上的权限\"></a>例如，收回test用户在表t1上的权限</h3><p>hbase(main)&gt; revoke ‘test’,’t1’</p>\n<p>###Region管理<br>1）移动region</p>\n<h3 id=\"语法：move-‘encodeRegionName’-‘ServerName’\"><a href=\"#语法：move-‘encodeRegionName’-‘ServerName’\" class=\"headerlink\" title=\"语法：move ‘encodeRegionName’, ‘ServerName’\"></a>语法：move ‘encodeRegionName’, ‘ServerName’</h3><h3 id=\"encodeRegionName指的regioName后面的编码，ServerName指的是master-status的Region-Servers列表\"><a href=\"#encodeRegionName指的regioName后面的编码，ServerName指的是master-status的Region-Servers列表\" class=\"headerlink\" title=\"encodeRegionName指的regioName后面的编码，ServerName指的是master-status的Region Servers列表\"></a>encodeRegionName指的regioName后面的编码，ServerName指的是master-status的Region Servers列表</h3><h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><p>hbase(main)&gt;move ‘4343995a58be8e5bbc739af1e91cd72d’, ‘db-41.xxx.xxx.org,60020,1390274516739’</p>\n<p>2）开启/关闭region</p>\n<h3 id=\"语法：balance-switch-true-false\"><a href=\"#语法：balance-switch-true-false\" class=\"headerlink\" title=\"语法：balance_switch true|false\"></a>语法：balance_switch true|false</h3><p>hbase(main)&gt; balance_switch</p>\n<p>3）手动split</p>\n<h3 id=\"语法：split-‘regionName’-‘splitKey’\"><a href=\"#语法：split-‘regionName’-‘splitKey’\" class=\"headerlink\" title=\"语法：split ‘regionName’, ‘splitKey’\"></a>语法：split ‘regionName’, ‘splitKey’</h3><p>4）手动触发major compaction</p>\n<h3 id=\"语法：\"><a href=\"#语法：\" class=\"headerlink\" title=\"语法：\"></a>语法：</h3><pre><code>Compact all regions in a table:\nhbase&gt; major_compact &#39;t1&#39;\nCompact an entire region:\nhbase&gt; major_compact &#39;r1&#39;\nCompact a single column family within a region:\nhbase&gt; major_compact &#39;r1&#39;, &#39;c1&#39;\nCompact a single column family within a table:\nhbase&gt; major_compact &#39;t1&#39;, &#39;c1&#39;\n</code></pre><h2 id=\"配置管理及节点重启\"><a href=\"#配置管理及节点重启\" class=\"headerlink\" title=\"配置管理及节点重启\"></a>配置管理及节点重启</h2><p>1）修改hdfs配置 hdfs配置位置：/etc/hadoop/conf</p>\n<h2 id=\"同步hdfs配置\"><a href=\"#同步hdfs配置\" class=\"headerlink\" title=\"同步hdfs配置\"></a>同步hdfs配置</h2><p>cat /home/hadoop/slaves|xargs -i -t scp /etc/hadoop/conf/hdfs-site.xml hadoop@{}:/etc/hadoop/conf/hdfs-site.xml</p>\n<h2 id=\"关闭：\"><a href=\"#关闭：\" class=\"headerlink\" title=\"关闭：\"></a>关闭：</h2><p>cat /home/hadoop/slaves|xargs -i -t ssh hadoop@{} “sudo /home/hadoop/cdh4/hadoop-2.0.0-cdh4.2.1/sbin/hadoop-daemon.sh –config /etc/hadoop/conf stop datanode”</p>\n<h2 id=\"启动：\"><a href=\"#启动：\" class=\"headerlink\" title=\"启动：\"></a>启动：</h2><p>cat /home/hadoop/slaves|xargs -i -t ssh hadoop@{} “sudo /home/hadoop/cdh4/hadoop-2.0.0-cdh4.2.1/sbin/hadoop-daemon.sh –config /etc/hadoop/conf start datanode”</p>\n<p>2）修改hbase配置</p>\n<h2 id=\"hbase配置位置：\"><a href=\"#hbase配置位置：\" class=\"headerlink\" title=\"hbase配置位置：\"></a>hbase配置位置：</h2><h2 id=\"同步hbase配置\"><a href=\"#同步hbase配置\" class=\"headerlink\" title=\"同步hbase配置\"></a>同步hbase配置</h2><p>cat /home/hadoop/hbase/conf/regionservers|xargs -i -t scp /home/hadoop/hbase/conf/hbase-site.xml hadoop@{}:/home/hadoop/hbase/conf/hbase-site.xml</p>\n<h2 id=\"graceful重启\"><a href=\"#graceful重启\" class=\"headerlink\" title=\"graceful重启\"></a>graceful重启</h2><p>cd ~/hbase<br>bin/graceful_stop.sh –restart –reload –debug inspurXXX.xxx.xxx.org</p>\n","categories":[{"name":"HBase","path":"api/categories/HBase.json"}],"tags":[{"name":"ForRemember","path":"api/tags/ForRemember.json"},{"name":"HBase","path":"api/tags/HBase.json"}]}